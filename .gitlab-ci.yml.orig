# do not use "latest" here, if you want this to work in the future
default:
  image: ubuntu:22.04
  tags:
    - shell-runner

stages:
  - build
  - test
  - deploy

before_script:
  - echo -n $DOCKER_REGISTRY_TOKEN | docker login -u $DOCKER_REGISTRY_USER --password-stdin $DOCKER_REGISTRY

include: 'ci-templates/*.yml'







<<<<<<< HEAD
###############################################
###               v3.4-rc1                     ###
###############################################

# Build_34:
#   stage: build
#   script:
#     - docker pull $DOCKER_REGISTRY_IMAGE:3.4-rc1  || true
#     - docker build 
#         --cache-from $DOCKER_REGISTRY_IMAGE:3.4-rc1
#         --tag $DOCKER_REGISTRY_IMAGE:3.4-rc1.$CI_PIPELINE_ID 
#         ./src/3.4-rc1
#     - docker push $DOCKER_REGISTRY_IMAGE:3.4-rc1.$CI_PIPELINE_ID
#   tags:
#     - shell-runner

# Test_34:
#   stage: test
#   needs: ["Build_34"]
#   script:
#     - docker pull $DOCKER_REGISTRY_IMAGE:3.4-rc1.$CI_PIPELINE_ID
#     - docker stop $(docker ps -q) 2>/dev/null || true
#     - docker rm -f $(docker ps -aq) 2>/dev/null || true
#     - docker ps
#     - docker run -i -d --rm -e NEST_CONTAINER_MODE=nest-server -p 5000:5000  
#         --name $CI_PIPELINE_ID $DOCKER_REGISTRY_IMAGE:3.4-rc1.$CI_PIPELINE_ID
#     - docker ps
#   tags:
#     - shell-runner

# Deploy_34:
#   stage: deploy
#   needs: ["Test_34"]
#   script:
#     - docker pull $DOCKER_REGISTRY_IMAGE:3.4-rc1.$CI_PIPELINE_ID
#     - docker tag $DOCKER_REGISTRY_IMAGE:3.4-rc1.$CI_PIPELINE_ID $DOCKER_REGISTRY_IMAGE:3.4-rc1
#     - docker push $DOCKER_REGISTRY_IMAGE:3.4-rc1
#   tags:
#     - shell-runner



###############################################
###               v3.3                     ###
###############################################
=======
>>>>>>> master



